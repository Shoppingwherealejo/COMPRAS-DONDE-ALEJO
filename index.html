<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>COMPRAS DONDE ALEJO</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "Alejo123", // üîÅ Reemplaza esto por tu apiKey real
      authDomain: "compras-donde-alejo.firebaseapp.com",
      projectId: "compras-donde-alejo",
      storageBucket: "compras-donde-alejo.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abc123"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    let modoAdmin = false;

    document.getElementById("admin-btn").addEventListener("click", () => {
      const clave = prompt("Ingresa la clave de administrador:");
      if (clave === "alejo123") {
        modoAdmin = true;
        document.querySelector(".formulario").style.display = "block";
        document.querySelectorAll(".admin-btns").forEach(btns => btns.style.display = "block");
      } else {
        alert("Clave incorrecta.");
      }
    });

    document.getElementById("add-product-form").addEventListener("submit", async (e) => {
      e.preventDefault();
      const id = document.getElementById("edit-id").value;
      const nombre = document.getElementById("nombre").value;
      const descripcion = document.getElementById("descripcion").value;
      const imagen = document.getElementById("imagen").value;
      const categoria = document.getElementById("categoria-producto").value;

      if (id) {
        const ref = doc(db, "productos", id);
        await updateDoc(ref, { nombre, descripcion, imagen, categoria });
      } else {
        await addDoc(collection(db, "productos"), { nombre, descripcion, imagen, categoria });
      }

      alert("Producto guardado.");
      location.reload();
    });

    async function cargarProductos() {
      const contenedor = document.querySelector(".catalogo");
      contenedor.innerHTML = "";
      const querySnapshot = await getDocs(collection(db, "productos"));
      querySnapshot.forEach((docSnap) => {
        const p = docSnap.data();
        const id = docSnap.id;
        const div = document.createElement("div");
        div.className = `producto ${p.categoria} show`;
        div.innerHTML = `
          <img src="${p.imagen}" alt="${p.nombre}" />
          <h2>${p.nombre}</h2>
          <p>${p.descripcion}</p>
          <a class="whatsapp-btn" href="https://wa.me/573008148195?text=Hola!%20Quiero%20comprar%20${encodeURIComponent(p.nombre)}">Comprar</a>
          <div class="admin-btns" style="display:none; margin-top:10px;">
            <button onclick="editarProducto('${id}', '${p.nombre}', '${p.descripcion}', '${p.imagen}', '${p.categoria}')">‚úèÔ∏è</button>
            <button onclick="eliminarProducto('${id}')">üóëÔ∏è</button>
          </div>
        `;
        contenedor.appendChild(div);
      });
    }

    window.editarProducto = function(id, nombre, descripcion, imagen, categoria) {
      document.getElementById("edit-id").value = id;
      document.getElementById("nombre").value = nombre;
      document.getElementById("descripcion").value = descripcion;
      document.getElementById("imagen").value = imagen;
      document.getElementById("categoria-producto").value = categoria;
    }

    window.eliminarProducto = async function(id) {
      if (confirm("¬øEliminar este producto?")) {
        await deleteDoc(doc(db, "productos", id));
        alert("Producto eliminado.");
        location.reload();
      }
    }

    window.filtrarProductos = function () {
      const filtro = document.getElementById("categoria").value;
      document.querySelectorAll(".producto").forEach(p => {
        p.style.display = (filtro === "todos" || p.classList.contains(filtro)) ? "block" : "none";
      });
    }

    window.onload = cargarProductos;
  </script>
  <style>
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Segoe UI', sans-serif; background: #0e0e0e; color: #fff; }
    header { background: #151515; padding: 20px 40px; display: flex; justify-content: space-between; align-items: center; position: relative; }
    .header-left { text-align: center; flex: 1; }
    .header-left h1 { margin: 0; color: #00aaff; }
    .header-left p { color: #ccc; margin: 5px 0 0; }
    .logo { max-height: 60px; }
    #admin-btn { position: absolute; top: 10px; left: 10px; background: #444; color: white; border: none; border-radius: 6px; padding: 6px 10px; cursor: pointer; font-size: 18px; }
    nav { background: #121212; padding: 12px; text-align: center; }
    nav select { padding: 10px; font-size: 16px; border-radius: 6px; background: #1a1a1a; color: #00aaff; border: none; }
    .catalogo { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 25px; padding: 40px 30px; }
    .producto { background: #1a1a1a; border-radius: 12px; padding: 20px; text-align: center; }
    .producto img { max-width: 100%; border-radius: 8px; }
    .producto h2 { color: #00aaff; margin-top: 15px; }
    .producto p { color: #ccc; }
    .whatsapp-btn { display: inline-block; margin-top: 12px; padding: 10px 22px; background: #25D366; color: white; border-radius: 6px; text-decoration: none; }
    .formulario { display: none; max-width: 400px; margin: 30px auto; background: #1f1f1f; padding: 20px; border-radius: 10px; }
    .formulario input, .formulario select { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 6px; border: none; background: #2a2a2a; color: white; }
    .formulario button { width: 100%; padding: 10px; background: #00aaff; border: none; border-radius: 6px; color: white; font-weight: bold; cursor: pointer; }
  </style>
</head>
<body>
  <header>
    <button id="admin-btn">üîß</button>
    <div class="header-left">
      <h1>COMPRAS DONDE ALEJO</h1>
      <p>¬°Bienvenido a tu tienda confiable de productos variados!</p>
    </div>
    <img src="logo-cda.png" alt="Logo" class="logo">
  </header>

  <div class="formulario">
    <form id="add-product-form">
      <input type="hidden" id="edit-id">
      <input type="text" id="nombre" placeholder="Nombre del producto" required>
      <input type="text" id="descripcion" placeholder="Descripci√≥n" required>
      <input type="text" id="imagen" placeholder="URL de la imagen" required>
      <select id="categoria-producto" required>
        <option value="tecnologia">Tecnolog√≠a</option>
        <option value="accesorios">Accesorios</option>
        <option value="hogar">Hogar</option>
        <option value="jugueteria">Jugueter√≠a</option>
        <option value="belleza">Belleza</option>
        <option value="salud">Salud</option>
        <option value="mascotas">Mascotas</option>
        <option value="cuidado-personal">Cuidado personal</option>
      </select>
      <button type="submit">Guardar producto</button>
    </form>
  </div>

  <nav>
    <label for="categoria">Filtrar por categor√≠a:</label>
    <select id="categoria" onchange="filtrarProductos()">
      <option value="todos">Mostrar todos</option>
      <option value="tecnologia">Tecnolog√≠a</option>
      <option value="accesorios">Accesorios</option>
      <option value="hogar">Hogar</option>
      <option value="jugueteria">Jugueter√≠a</option>
      <option value="belleza">Belleza</option>
      <option value="salud">Salud</option>
      <option value="mascotas">Mascotas</option>
      <option value="cuidado-personal">Cuidado personal</option>
    </select>
  </nav>

  <section class="catalogo"></section>
</body>
</html>
